#!/bin/bash

#set -e

# Script Dir
pushd `dirname $0` > /dev/null
SP=`pwd`
popd > /dev/null

pushd $SP/.. > /dev/null

git ls-files --exclude-standard --other --error-unmatch . >/dev/null 2>&1; ec=$?
if test "$ec" = 0; then
    echo "Untracked files found, aborting."
    exit 1
elif test "$ec" = 1; then
    echo "No untracked files, proceeding."
else
    echo "Error checking untracked files status."
    exit 1
fi

git diff-files --quiet >/dev/null 2>&1; ec=$?
if test "$ec" = 1; then
    echo "Uncommitted changes found, aborting."
    exit 1
elif test "$ec" = 0; then
    echo "No uncommitted changes, proceeding."
else
    echo "Error checking uncommitted changes status."
    exit 1
fi

set -e

git checkout master

#find ! -name 'static' -type d -exec rm -f {} +
rm -f !(static)

popd > /dev/null
